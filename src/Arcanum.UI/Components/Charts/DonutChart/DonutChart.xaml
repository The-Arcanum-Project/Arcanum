<UserControl x:Class = "Arcanum.UI.Components.Charts.DonutChart.DonutChart"
             xmlns = "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x = "http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc = "http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d = "http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local = "clr-namespace:Arcanum.UI.Components.Charts.DonutChart" mc:Ignorable = "d"
             d:DesignHeight = "300" d:DesignWidth = "300">

    <UserControl.Resources>
        <local:DonutLegendTextConverter x:Key = "DonutLegendTextConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width = "Auto" />
            <ColumnDefinition Width = "*" />
        </Grid.ColumnDefinitions>

        <!-- Chart Area -->
        <Grid Grid.Column = "0" Width = "{Binding ChartSize, RelativeSource={RelativeSource AncestorType=UserControl}}"
              Height = "{Binding ChartSize, RelativeSource={RelativeSource AncestorType=UserControl}}" Margin = "5">

            <!-- Background Ring -->
            <Ellipse Stroke = "{DynamicResource DefaultBorderColorBrush}"
                     StrokeThickness = "{Binding StrokeThickness, RelativeSource={RelativeSource AncestorType=UserControl}}" />

            <Canvas x:Name = "ChartCanvas" />

            <TextBlock Text = "{Binding CenterText, RelativeSource={RelativeSource AncestorType=UserControl}}"
                       VerticalAlignment = "Center" HorizontalAlignment = "Center" FontWeight = "Bold" FontSize = "14"
                       TextTrimming = "CharacterEllipsis" />
        </Grid>

        <!-- Legend -->
        <ScrollViewer Grid.Column = "1" VerticalScrollBarVisibility = "Auto" Margin = "10,0,0,0"
                      VerticalAlignment = "Center">
            <ItemsControl
                ItemsSource = "{Binding ItemsSource, RelativeSource={RelativeSource AncestorType=UserControl}}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType = "local:BasicChartItem">
                        <Grid Margin = "0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width = "12" />
                                <ColumnDefinition Width = "*" />
                                <ColumnDefinition Width = "Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Color Dot -->
                            <Border Width = "10" Height = "10" CornerRadius = "5" Background = "{Binding ColorBrush}"
                                    VerticalAlignment = "Center" />

                            <!-- Name -->
                            <TextBlock Grid.Column = "1" Text = "{Binding Name}" Margin = "8,0"
                                       Foreground = "{DynamicResource DefaultForeColorBrush}" FontSize = "11"
                                       TextTrimming = "CharacterEllipsis" />

                            <!-- Value Test -->
                            <TextBlock Grid.Column = "2" Foreground = "{DynamicResource DefaultForeColorBrush}"
                                       FontSize = "11" FontWeight = "SemiBold">
                                <TextBlock.Text>
                                    <MultiBinding Converter = "{StaticResource DonutLegendTextConverter}">
                                        <Binding Path = "Value" />
                                        <!-- Bind to the calculated total -->
                                        <Binding Path = "CurrentTotal"
                                                 RelativeSource = "{RelativeSource AncestorType=UserControl}" />
                                        <!-- Config Flags -->
                                        <Binding Path = "ShowLegendValues"
                                                 RelativeSource = "{RelativeSource AncestorType=UserControl}" />
                                        <Binding Path = "ShowLegendPercentage"
                                                 RelativeSource = "{RelativeSource AncestorType=UserControl}" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>