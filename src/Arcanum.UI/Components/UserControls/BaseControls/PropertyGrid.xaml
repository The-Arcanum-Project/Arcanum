<UserControl x:Class = "Arcanum.UI.Components.UserControls.BaseControls.PropertyGrid"
             xmlns = "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x = "http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:propItem = "clr-namespace:Arcanum.Core.Utils.DelayedEvents;assembly=Arcanum.Core"
             xmlns:converters = "clr-namespace:Arcanum.UI.Components.Converters"
             xmlns:styleClasses = "clr-namespace:Arcanum.UI.Components.StyleClasses"
             xmlns:baseControls = "clr-namespace:Arcanum.UI.Components.UserControls.BaseControls"
             xmlns:sys = "clr-namespace:System;assembly=System.Runtime"
             xmlns:propertyGrid = "clr-namespace:Arcanum.UI.Components.UserControls.PropertyGrid">


    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source = "/Arcanum_UI;component/Assets/ArcanumShared/DefaultPalette.xaml" />
                <ResourceDictionary Source = "/Arcanum_UI;component/Assets/ArcanumShared/DefaultFonts.xaml" />
                <ResourceDictionary Source = "/Arcanum_UI;component/Components/Styles/Base/BaseContextMenu.xaml" />
                <ResourceDictionary Source = "/Arcanum_UI;component/Components/Styles/Base/BaseButton.xaml" />
                <ResourceDictionary Source = "/Arcanum_UI;component/Components/Styles/Base/BaseComboBoxStyle.xaml" />
                <ResourceDictionary Source = "/Arcanum_UI;component/Components/Styles/Specific/BorderlessComboBox.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:EnumValuesConverter x:Key = "EnumValuesConverter" />
            <converters:EnumValueConverter x:Key = "EnumValueConverter" />
            <converters:EnumValuesFromValueConverter x:Key = "EnumValuesProviderConverter" />
            <converters:EnumValueFromValueConverter x:Key = "EnumValueProviderConverter" />
            <converters:EnumValuesToStringConverter x:Key = "EnumValuesToString" />
            <converters:DecimalDoubleConverter x:Key = "DecimalDoubleConverter" />
            <converters:BoolToVisibilityConverter x:Key = "BoolToVisibilityConverter" />
            <converters:TypeToStringConverter x:Key = "TypeToStringConverter" />

            <Style x:Key = "ViewDetailsButtonStyle"
                   TargetType = "styleClasses:BaseButton"
                   BasedOn = "{StaticResource {x:Type styleClasses:BaseButton}}">
                <Setter Property = "Margin"
                        Value = "2" />
                <Setter Property = "Padding"
                        Value = "0" />
                <Setter Property = "VerticalAlignment"
                        Value = "Stretch" />
                <Setter Property = "HorizontalAlignment"
                        Value = "Stretch" />
                <Setter Property = "BorderThickness"
                        Value = "0" />

                <Setter Property = "ContentTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <Image Source = "/Arcanum_UI;component/Assets/Icons/20x20/Eye20x20.png"
                                   VerticalAlignment = "Center"
                                   HorizontalAlignment = "Center"
                                   Stretch = "UniformToFill" />
                        </DataTemplate>
                    </Setter.Value>
                </Setter>

            </Style>

            <DataTemplate x:Key = "StringTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <styleClasses:CorneredTextBox
                    Text = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Margin = "0, 0, 6, 0"
                    VerticalAlignment = "Center"
                    HorizontalAlignment = "Stretch"
                    BorderThickness = "0"
                    Background = "Transparent"
                    TextWrapping = "NoWrap"
                    Foreground = "{StaticResource DefaultForeColorBrush}"
                    CaretBrush = "{StaticResource DefaultForeColorBrush}" />
            </DataTemplate>

            <DataTemplate x:Key = "BoolTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <CheckBox IsChecked = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            </DataTemplate>

            <DataTemplate x:Key = "EnumTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
                <ComboBox ItemsSource = "{Binding Type, Converter={StaticResource EnumValuesConverter}}"
                          SelectedItem = "{Binding Value,Converter={StaticResource EnumValueConverter}, Mode=TwoWay}"
                          Margin = "1, 1, 4, 1"
                          Background = "Transparent"
                          ToolTip = "{Binding SelectedItem.Description, RelativeSource={RelativeSource Self}}"
                          TextSearch.TextPath = "Value"
                          ToolTipService.InitialShowDelay = "100">
                    <ComboBox.Style>
                        <Style TargetType = "ComboBox"
                               BasedOn = "{StaticResource BorderlessComboboxStyle}">
                            <Setter Property = "ItemContainerStyle">
                                <Setter.Value>
                                    <!-- ReSharper disable once Xaml.BindingWithContextNotResolved -->
                                    <Style TargetType = "ComboBoxItem"
                                           BasedOn = "{StaticResource BaseComboBoxItemStyle}">
                                        <Setter Property = "ToolTip"
                                                Value = "{Binding Description}" />
                                        <Setter Property = "ToolTipService.InitialShowDelay"
                                                Value = "100" />
                                    </Style>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ComboBox.Style>
                </ComboBox>
            </DataTemplate>

            <DataTemplate x:Key = "DefaultTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <TextBlock Text = "{Binding Value}"
                           Width = "150"
                           Margin = "1" />
            </DataTemplate>

            <DataTemplate x:Key = "IntTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <baseControls:BaseNumericUpDown
                    Value = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Margin = "0, 0, 6, 0"
                    Background = "Transparent"
                    BorderThickness = "0"
                    Padding = "0"
                    HorizontalAlignment = "Stretch"
                    VerticalAlignment = "Stretch"
                    MaxValue = "{x:Static sys:Int32.MaxValue}"
                    MinValue = "{x:Static sys:Int32.MinValue}" />
            </DataTemplate>

            <DataTemplate x:Key = "DecimalTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <baseControls:DecimalBaseNumericUpDown
                    Value = "{Binding Value, Mode=TwoWay, Converter={StaticResource DecimalDoubleConverter}}"
                    Margin = "0, 0, 6, 0"
                    Background = "Transparent"
                    BorderThickness = "0"
                    Padding = "0"
                    HorizontalAlignment = "Stretch"
                    VerticalAlignment = "Stretch"
                    MaxValue = "{x:Static sys:Decimal.MaxValue}"
                    MinValue = "{x:Static sys:Decimal.MinValue}" />
            </DataTemplate>

            <DataTemplate x:Key = "FloatTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <baseControls:FloatNumericUpDown
                    Value = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Margin = "0, 0, 6, 0"
                    Background = "Transparent"
                    BorderThickness = "0"
                    Padding = "0"
                    HorizontalAlignment = "Stretch"
                    VerticalAlignment = "Stretch"
                    MaxValue = "{x:Static sys:Single.MaxValue}"
                    MinValue = "{x:Static sys:Single.MinValue}" />
            </DataTemplate>

            <DataTemplate x:Key = "ObjectTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">

                <Grid Margin = "3, 0, 6, 0"
                      HorizontalAlignment = "Stretch"
                      VerticalAlignment = "Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width = "1*" />
                        <ColumnDefinition Width = "20" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text = "{Binding Value, Converter={StaticResource TypeToStringConverter}}"
                               TextSearch.TextPath = "Value"
                               Margin = "2, 0, 0, 0"
                               VerticalAlignment = "Center"
                               HorizontalAlignment = "Left" />

                    <styleClasses:BaseButton Grid.Column = "1"
                                             Style = "{StaticResource ViewDetailsButtonStyle}"
                                             Click = "ViewObject_Button_Click" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key = "CollectionTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <Grid Margin = "3, 0, 6, 0"
                      HorizontalAlignment = "Stretch"
                      VerticalAlignment = "Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width = "1*" />
                        <ColumnDefinition Width = "20" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text = "{Binding CollectionDescription}"
                               Margin = "2, 0, 0, 0"
                               VerticalAlignment = "Center"
                               HorizontalAlignment = "Left" />

                    <styleClasses:BaseButton Grid.Column = "1"
                                             Style = "{StaticResource ViewDetailsButtonStyle}"
                                             Click = "ViewCollection_Button_Click" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key = "SingleEnumEditorTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <ComboBox ItemsSource = "{Binding Value, Converter={StaticResource EnumValuesProviderConverter}}"
                          SelectedItem = "{Binding Value,Converter={StaticResource EnumValueProviderConverter}, Mode=TwoWay}"
                          Margin = "1, 1, 4, 1"
                          Background = "Transparent"
                          TextSearch.TextPath = "Value"
                          BorderThickness = "0">
                </ComboBox>
            </DataTemplate>

            <DataTemplate x:Key = "EnumArrayEditorTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width = "1*" />
                        <ColumnDefinition Width = "20" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column = "0"
                               Text = "{Binding Value, Converter={StaticResource EnumValuesToString}}">
                    </TextBlock>

                    <styleClasses:BaseButton Grid.Column = "1"
                                             Style = "{StaticResource ViewDetailsButtonStyle}"
                                             Click = "ViewEnumArray_Button_Click" />

                </Grid>


            </DataTemplate>

            <propertyGrid:PropertyEditorTemplateSelector x:Key = "PropertyEditorSelector"
                                                         StringTemplate = "{StaticResource StringTemplate}"
                                                         BoolTemplate = "{StaticResource BoolTemplate}"
                                                         EnumTemplate = "{StaticResource EnumTemplate}"
                                                         IntTemplate = "{StaticResource IntTemplate}"
                                                         DecimalTemplate = "{StaticResource DecimalTemplate}"
                                                         FloatTemplate = "{StaticResource FloatTemplate}"
                                                         CollectionTemplate = "{StaticResource CollectionTemplate}"
                                                         ObjectTemplate = "{StaticResource ObjectTemplate}"
                                                         DefaultTemplate = "{StaticResource DefaultTemplate}"
                                                         SingleEnumTemplate = "{StaticResource SingleEnumEditorTemplate}"
                                                         EnumArrayTemplate = "{StaticResource EnumArrayEditorTemplate}">

                <!-- <propertyGrid:PropertyEditorTemplateSelector.CustomTemplates> -->
                <!--     <propertyGrid:TypeTemplatePair Type="{x:Type win:Point}" Template="{StaticResource PointTemplate}" /> -->
                <!--      -->
                <!-- </propertyGrid:PropertyEditorTemplateSelector.CustomTemplates> -->
            </propertyGrid:PropertyEditorTemplateSelector>


            <DataTemplate x:Key = "PropertyRowTemplate"
                          DataType = "{x:Type propItem:PropertyItem}">
                <Border x:Name = "OuterBorder"
                        BorderThickness = "1"
                        Margin = "2, 0"
                        CornerRadius = "4">
                    <Grid HorizontalAlignment = "Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition
                                Width = "{Binding LabelWidth, RelativeSource={RelativeSource AncestorType={x:Type baseControls:PropertyGrid}}}" />
                            <ColumnDefinition Width = "7" />
                            <ColumnDefinition Width = "1*" />

                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "20" />
                            <RowDefinition Height = "3" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row = "0"
                                   Grid.Column = "0"
                                   Text = "{Binding FormattedName}"
                                   VerticalAlignment = "Center"
                                   Margin = "7, 0, 0, 0" />

                        <Rectangle Grid.Row = "0"
                                   Grid.Column = "1"
                                   Width = "1"
                                   Margin = "3"
                                   Fill = "{StaticResource LightBackColorBrush}" />

                        <Border x:Name = "Border"
                                Grid.Row = "0"
                                Grid.Column = "2"
                                Background = "Transparent"
                                CornerRadius = "3">
                            <ContentPresenter Content = "{Binding}"
                                              ContentTemplateSelector = "{StaticResource PropertyEditorSelector}" />

                        </Border>

                        <Rectangle Grid.Row = "1"
                                   Grid.Column = "0"
                                   Grid.ColumnSpan = "3"
                                   Height = "1"
                                   Fill = "{StaticResource LightBackColorBrush}"
                                   Margin = "6,0" />
                    </Grid>
                    <Border.Style>
                        <Style TargetType = "Border">
                            <Setter Property = "BorderBrush"
                                    Value = "Transparent" />
                            <Style.Triggers>
                                <DataTrigger
                                    Binding = "{Binding IsSelected, 
                                RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                                    Value = "True">
                                    <Setter Property = "BorderBrush"
                                            Value = "{StaticResource BlueSelectionBackColorBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
            </DataTemplate>
        </ResourceDictionary>

    </UserControl.Resources>

    <Border CornerRadius = "3"
            BorderBrush = "{StaticResource DefaultBorderColorBrush}"
            BorderThickness = "2"
            Margin = "{Binding Margin, RelativeSource={RelativeSource AncestorType=UserControl}}"
            Background = "{StaticResource DefaultBackColorBrush}"
            VerticalAlignment = "Stretch"
            HorizontalAlignment = "Stretch">
        <Grid>
            <Grid.Resources>
                <Style TargetType = "{x:Type Grid}">
                    <Setter Property = "Background"
                            Value = "{StaticResource DefaultBackColorBrush}" />
                </Style>
            </Grid.Resources>
            <Grid.RowDefinitions>
                <RowDefinition Height = "24" />
                <RowDefinition Height = "1*" />
                <RowDefinition Height = "Auto" />
                <RowDefinition Height = "Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width = "1*" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row = "0"
                       Text = "{Binding Title, RelativeSource={RelativeSource AncestorType=baseControls:PropertyGrid}}"
                       FontWeight = "Bold"
                       Margin = "0"
                       Padding = "5,0"
                       FontSize = "16"
                       Foreground = "{StaticResource DefaultForeColorBrush}"
                       Background = "{StaticResource LightBackColorBrush}"
                       HorizontalAlignment = "Stretch"
                       VerticalAlignment = "Stretch" />

            <ListBox x:Name = "PropertyList"
                     Grid.Row = "1"
                     ItemsSource = "{Binding Properties, RelativeSource={RelativeSource AncestorType=UserControl}}"
                     ItemTemplate = "{StaticResource PropertyRowTemplate}"
                     BorderThickness = "0"
                     Margin = "0"
                     Padding = "0, 0, -12, 0"
                     Background = "{StaticResource DefaultBackColorBrush}"
                     ScrollViewer.VerticalScrollBarVisibility = "Auto"
                     ScrollViewer.HorizontalScrollBarVisibility = "Disabled"
                     HorizontalContentAlignment = "Stretch" />


            <Border Grid.Row = "2"
                    x:Name = "GridEmbeddedBorder"
                    BorderThickness = "0"
                    Visibility = "{Binding ShowGridEmbedded, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibilityConverter}}"
                    Height = "250">
            </Border>

            <Grid Grid.Row = "3"
                  x:Name = "DescriptionGrid"
                  MinHeight = "40"
                  MaxHeight = "100"
                  Margin = "2"
                  Background = "Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width = "*" />
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition Height = "2" />
                    <RowDefinition Height = "1*" />
                </Grid.RowDefinitions>

                <Rectangle Grid.Row = "0"
                           Height = "2"
                           Fill = "{StaticResource LightBackColorBrush}"
                           Margin = "3, 0"
                           HorizontalAlignment = "Stretch"
                           VerticalAlignment = "Stretch" />

                <TextBlock Grid.Row = "1"
                           x:Name = "DescriptionTextBlock"
                           Margin = "4"
                           Text = "{Binding Description, RelativeSource={RelativeSource AncestorType=UserControl}}"
                           TextWrapping = "Wrap">
                </TextBlock>
            </Grid>

        </Grid>
    </Border>
</UserControl>