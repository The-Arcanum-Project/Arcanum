<UserControl x:Class = "Arcanum.UI.Components.UserControls.BaseControls.PropertyGrid"
             xmlns = "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x = "http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:uc = "clr-namespace:Arcanum.UI.Components.UserControls"
             xmlns:delayedEvents = "clr-namespace:Arcanum.Core.Utils.DelayedEvents;assembly=Arcanum.Core"
             xmlns:converters = "clr-namespace:Arcanum.UI.Components.Converters"
             xmlns:styleClasses = "clr-namespace:Arcanum.UI.Components.StyleClasses"
             xmlns:baseControls = "clr-namespace:Arcanum.UI.Components.UserControls.BaseControls"
             xmlns:sys = "clr-namespace:System;assembly=System.Runtime">


    <UserControl.Resources>
        <converters:EnumValuesConverter x:Key = "EnumValuesConverter" />
        <converters:EnumValueConverter x:Key = "EnumValueConverter" />
        <converters:DecimalDoubleConverter x:Key = "DecimalDoubleConverter" />
        <converters:BoolToVisibilityConverter x:Key = "BoolToVisibilityConverter" />
        <converters:TypeToStringConverter x:Key = "TypeToStringConverter" />

        <DataTemplate x:Key = "StringTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <styleClasses:CorneredTextBox Text = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          Margin = "0, 0, 6, 0"
                                          VerticalAlignment = "Center"
                                          HorizontalAlignment = "Stretch"
                                          BorderThickness = "0"
                                          Background = "Transparent"
                                          TextWrapping = "NoWrap"
                                          Foreground = "{StaticResource DefaultForeColorBrush}"
                                          CaretBrush = "{StaticResource DefaultForeColorBrush}" />
        </DataTemplate>

        <DataTemplate x:Key = "BoolTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <CheckBox IsChecked = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
        </DataTemplate>

        <DataTemplate x:Key = "EnumTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <ComboBox ItemsSource = "{Binding Type, Converter={StaticResource EnumValuesConverter}}"
                      SelectedItem = "{Binding Value,Converter={StaticResource EnumValueConverter}, Mode=TwoWay}"
                      Margin = "1, 1, 4, 1"
                      Background = "Transparent"
                      ToolTip="{Binding SelectedItem.Description, RelativeSource={RelativeSource Self}}"
                      TextSearch.TextPath="Value"
                      ToolTipService.InitialShowDelay="100">
                <ComboBox.Style>
                    <Style TargetType = "ComboBox"
                           BasedOn = "{StaticResource BorderlessComboboxStyle}">
                        <Setter Property = "ItemContainerStyle">
                            <Setter.Value>
                                <Style TargetType = "ComboBoxItem"
                                       BasedOn = "{StaticResource BaseComboBoxItemStyle}">
                                    <Setter Property = "ToolTip"
                                            Value = "{Binding Description}" />
                                    <Setter Property = "ToolTipService.InitialShowDelay"
                                            Value = "100" />
                                </Style>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ComboBox.Style>
            </ComboBox>
        </DataTemplate>

        <DataTemplate x:Key = "DefaultTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <TextBlock Text = "{Binding Value}"
                       Width = "150"
                       Margin = "1" />
        </DataTemplate>

        <DataTemplate x:Key = "IntTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <baseControls:BaseNumericUpDown Value = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Margin = "0, 0, 6, 0"
                                            Background = "Transparent"
                                            BorderThickness = "0"
                                            Padding = "0"
                                            HorizontalAlignment = "Stretch"
                                            VerticalAlignment = "Stretch"
                                            MaxValue="{x:Static sys:Int32.MaxValue}"
                                            MinValue="{x:Static sys:Int32.MinValue}"/>
        </DataTemplate>

        <DataTemplate x:Key = "DecimalTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <baseControls:DecimalBaseNumericUpDown
                Value = "{Binding Value, Mode=TwoWay, Converter={StaticResource DecimalDoubleConverter}}"
                Margin = "0, 0, 6, 0"
                Background = "Transparent"
                BorderThickness = "0"
                Padding = "0"
                HorizontalAlignment = "Stretch"
                VerticalAlignment = "Stretch" />
        </DataTemplate>

        <DataTemplate x:Key = "FloatTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <baseControls:FloatNumericUpDown
                Value = "{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                Margin = "0, 0, 6, 0"
                Background = "Transparent"
                BorderThickness = "0"
                Padding = "0"
                HorizontalAlignment = "Stretch"
                VerticalAlignment = "Stretch" />
        </DataTemplate>

        <DataTemplate x:Key = "ObjectTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">

            <Grid Margin = "3, 0, 6, 0"
                  HorizontalAlignment = "Stretch"
                  VerticalAlignment = "Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width = "1*" />
                    <ColumnDefinition Width = "20" />
                </Grid.ColumnDefinitions>

                <TextBlock Text = "{Binding Value, Converter={StaticResource TypeToStringConverter}}"
                           TextSearch.TextPath="Value"
                           Margin = "2, 0, 0, 0"
                           VerticalAlignment = "Center"
                           HorizontalAlignment = "Left" />

                <styleClasses:BaseButton Grid.Column = "1"
                                         Margin = "2"
                                         Padding = "0"
                                         VerticalAlignment = "Stretch"
                                         Click = "ViewObject_Button_Click"
                                         HorizontalAlignment = "Stretch">
                    <Image Source = "/Assets/Icons/20x20/Eye20x20.png"
                           VerticalAlignment = "Center"
                           HorizontalAlignment = "Center"
                           Stretch = "UniformToFill"
                           Margin = "0" />
                </styleClasses:BaseButton>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key = "CollectionTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <Grid Margin = "3, 0, 6, 0"
                  HorizontalAlignment = "Stretch"
                  VerticalAlignment = "Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width = "1*" />
                    <ColumnDefinition Width = "20" />
                </Grid.ColumnDefinitions>

                <TextBlock Text = "{Binding CollectionDescription}"
                           Margin = "2, 0, 0, 0"
                           VerticalAlignment = "Center"
                           HorizontalAlignment = "Left" />

                <styleClasses:BaseButton Grid.Column = "1"
                                         Margin = "2"
                                         Padding = "0"
                                         VerticalAlignment = "Stretch"
                                         Click = "ViewCollection_Button_Click"
                                         HorizontalAlignment = "Stretch">
                    <Image Source = "/Assets/Icons/20x20/Eye20x20.png"
                           VerticalAlignment = "Center"
                           HorizontalAlignment = "Center"
                           Stretch = "UniformToFill"
                           Margin = "0" />
                </styleClasses:BaseButton>
            </Grid>
        </DataTemplate>


        <uc:PropertyEditorTemplateSelector x:Key = "PropertyEditorSelector"
                                           StringTemplate = "{StaticResource StringTemplate}"
                                           BoolTemplate = "{StaticResource BoolTemplate}"
                                           EnumTemplate = "{StaticResource EnumTemplate}"
                                           IntTemplate = "{StaticResource IntTemplate}"
                                           DecimalTemplate = "{StaticResource DecimalTemplate}"
                                           FloatTemplate = "{StaticResource FloatTemplate}"
                                           CollectionTemplate = "{StaticResource CollectionTemplate}"
                                           ObjectTemplate = "{StaticResource ObjectTemplate}"
                                           DefaultTemplate = "{StaticResource DefaultTemplate}" />


        <DataTemplate x:Key = "PropertyRowTemplate"
                      DataType = "{x:Type delayedEvents:PropertyItem}">
            <Grid HorizontalAlignment = "Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition
                        Width = "{Binding LabelWidth, RelativeSource={RelativeSource AncestorType={x:Type baseControls:PropertyGrid}}}" />
                    <ColumnDefinition Width = "7" />
                    <ColumnDefinition Width = "1*" />

                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height = "20" />
                    <RowDefinition Height = "3" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row = "0"
                           Grid.Column = "0"
                           Text = "{Binding FormattedName}"
                           VerticalAlignment = "Center"
                           Margin = "7, 0, 0, 0" />

                <Rectangle Grid.Row = "0"
                           Grid.Column = "1"
                           Width = "1"
                           Margin = "3"
                           Fill = "{StaticResource LightBackColorBrush}" />

                <Border x:Name = "Border"
                        Grid.Row = "0"
                        Grid.Column = "2"
                        Background = "Transparent"
                        CornerRadius = "3">
                    <ContentPresenter Content = "{Binding}"
                                      ContentTemplateSelector = "{StaticResource PropertyEditorSelector}" />

                </Border>

                <Rectangle Grid.Row = "1"
                           Grid.Column = "0"
                           Grid.ColumnSpan = "3"
                           Height = "1"
                           Fill = "{StaticResource LightBackColorBrush}"
                           Margin = "6,0" />
            </Grid>
        </DataTemplate>

    </UserControl.Resources>

    <Border CornerRadius = "3"
            BorderBrush = "{StaticResource DefaultBorderColorBrush}"
            BorderThickness = "2"
            Margin = "{Binding Margin, RelativeSource={RelativeSource AncestorType=UserControl}}"
            Background = "{StaticResource DefaultBackColorBrush}"
            VerticalAlignment = "Stretch"
            HorizontalAlignment = "Stretch">
        <Grid>
            <Grid.Resources>
                <Style TargetType = "{x:Type Grid}">
                    <Setter Property = "Background"
                            Value = "{StaticResource DefaultBackColorBrush}" />
                </Style>
            </Grid.Resources>
            <Grid.RowDefinitions>
                <RowDefinition Height = "24" />
                <RowDefinition Height = "1*" />
                <RowDefinition Height = "Auto" />
                <RowDefinition Height = "Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width = "1*" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row = "0"
                       Text = "{Binding Title, RelativeSource={RelativeSource AncestorType=baseControls:PropertyGrid}}"
                       FontWeight = "Bold"
                       Margin = "0"
                       Padding = "5,0"
                       FontSize = "16"
                       Foreground = "{StaticResource DefaultForeColorBrush}"
                       Background = "{StaticResource LightBackColorBrush}"
                       HorizontalAlignment = "Stretch"
                       VerticalAlignment = "Stretch" />

            <ListBox x:Name = "PropertyList"
                     Grid.Row = "1"
                     ItemsSource = "{Binding Properties, RelativeSource={RelativeSource AncestorType=UserControl}}"
                     ItemTemplate = "{StaticResource PropertyRowTemplate}"
                     BorderThickness = "0"
                     Margin = "0"
                     Padding = "0, 0, -12, 0"
                     Background = "{StaticResource DefaultBackColorBrush}"
                     ScrollViewer.VerticalScrollBarVisibility = "Auto"
                     ScrollViewer.HorizontalScrollBarVisibility = "Disabled"
                     HorizontalContentAlignment = "Stretch" />


            <Border Grid.Row = "2"
                    x:Name = "GridEmbeddedBorder"
                    BorderThickness = "0"
                    Visibility = "{Binding ShowGridEmbedded, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibilityConverter}}"
                    Height = "250">
            </Border>

            <Grid Grid.Row = "3"
                  x:Name = "DescriptionGrid"
                  MinHeight = "40"
                  MaxHeight = "100"
                  Margin = "2"
                  Background = "Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width = "*" />
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition Height = "2" />
                    <RowDefinition Height = "1*" />
                </Grid.RowDefinitions>

                <Rectangle Grid.Row = "0"
                           Height = "2"
                           Fill = "{StaticResource LightBackColorBrush}"
                           Margin = "3, 0"
                           HorizontalAlignment = "Stretch"
                           VerticalAlignment = "Stretch" />

                <TextBlock Grid.Row = "1"
                           x:Name = "DescriptionTextBlock"
                           Margin = "4"
                           Text = "{Binding Description, RelativeSource={RelativeSource AncestorType=UserControl}}"
                           TextWrapping = "Wrap">
                </TextBlock>
            </Grid>

        </Grid>
    </Border>
</UserControl>